includes:
- extension.neon
- rules.neon
rules:
#- MLL\Utils\PHPStan\Rules\ThrowableClassNameRule
- MLL\Utils\PHPStan\Rules\VariableNameIdToIDRule
# Disabled for legacy - this rule has different behavior in older PHPStan
# - MLL\Utils\PHPStan\Rules\MissingClosureParameterTypehintRule
parameters:
  level: max
  paths:
  - src
  - tests
  excludePaths:
  # Enum tests use PHP 8.1+ syntax
  - tests/Enum
  # TryFromNameTrait uses self::cases() which needs enum context
  - src/Enum
  tmpDir: .build/phpstan
  # As long as we support multiple PHP versions, there will be some dead spots
  reportUnmatchedIgnoredErrors: false
  ignoreErrors:
  # This is a library, so it should be extendable
  - '#Unsafe usage of new static.*#'

  # Not in older PHPUnit versions
  - '#Attribute class PHPUnit\\Framework\\Attributes\\DataProvider does not exist\.#'

  # Allows assert() calls to assist IDE autocompletion
  - message: '#Call to function assert\(\) with true.* will always evaluate to true\.#'

  # @phpstan-ignore inline comment not supported in older PHPStan
  - '#Unknown PHPDoc tag: @phpstan-ignore#'

  # Older PHPStan has stricter/different closure parameter typehint checking
  - '#Closure parameter .* is missing a native type hint\.#'

  # Differences in type inference between PHPStan versions
  - '#Cannot access property .* on mixed\.#'
  - '#Call to static method PHPUnit\\Framework\\Assert::assertNotNull\(\) with .* will always evaluate to true\.#'
  - '#Instanceof between .* and .* will always evaluate to true\.#'
  - '#Strict comparison using === between null and null will always evaluate to true\.#'
  - '#Unreachable statement - code above always terminates\.#'

  # PHPDoc parsing differences in older versions
  - '#PHPDoc tag @param has invalid value.*covariant.*#'

  # Return type differences in older PHPStan rule interfaces
  - '#Method MLL\\Utils\\PHPStan\\Rules\\MissingClosureParameterTypehintRule::processNode\(\) should return array<int, PHPStan\\Rules\\IdentifierRuleError> but returns array<int, PHPStan\\Rules\\RuleError>\.#'
